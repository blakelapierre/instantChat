[{"id":"52cb383e-d355-4e3e-915c-14178ec8ad58","provider":"digitalocean","location":"sfo1","size":"512mb","image":"coreos-alpha","keys":["40:85:f0:9b:28:ad:5d:25:b5:51:2e:ad:f3:b3:31:98"],"userData":"#cloud-config\n\ncoreos:\n  etcd:\n    discovery: https://discovery.etcd.io/56220a8c8c77ebd2171f6857c8a015a8\n    addr: $public_ipv4:4001\n    peer-addr: $public_ipv4:7001\n  fleet:\n    public-ip: $public_ipv4\n    metadata: provider=digitalocean,location=sfo1,role=influxdb,image=coreos-alpha,size=512mb,id=52cb383e-d355-4e3e-915c-14178ec8ad58\n\n  ssh_authorized_keys:\n    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDQIwGRmmZKxKiZyWRkGk95wBUuhmyitOfJQBlhLeL7n0qDxueU+oxRH3swrWYbHY8daOAKhlzQmpqAQSoFiLzdK0N5aDRyv5U01wvzRuWbQ3Fk/2iwOUzJx2y/rDVd3NbF26EBTS+7mS2n319r1TNYsuekzMD+VpZBFymcqttoOlgNnuecytpMFj18YuB3muGRgiAWZHx0md1e3/bVuVK16VEJ8MKFPWBsRiZ667gzW5b88XZO4Zvo/wAQgp6vakMaLOinxOt0IhfsVNU/miFd0AMBPq04s+iSApxBvQ/+DbBphQT4bRfgI8w8QgfwO8Hwz4MpojeAk2Dhsvmupyp blakelapierre@gmail.com\n\n  units:\n    - name: etcd.service\n      command: start\n\n    - name: fleet.socket\n      command: start\n      content: |\n        [Socket]\n        ListenStream=/var/run/fleet.socket\n        Service=fleet.service\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: fleet.service\n      command: start\n\n    - name: bootstrap.service\n      command: start\n      content: |\n        [Unit]\n        Description=boostraps us\n\n        Requires=etcd.service\n        Requires=fleet.socket\n        Requires=fleet.service\n        Requires=docker.service\n\n        After=etcd.service\n        After=fleet.socket\n        After=fleet.service\n        After=docker.service\n\n        [Service]\n        ExecStart=/home/core/bootstrap.sh\n\nwrite_files:\n  - path: /home/core/bootstrap.sh\n    owner: core\n    permissions: 0700\n    content: |\n      #!/bin/bash\n      \n      #DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n      \n      cd /home/core\n      \n      \n      (\n        SWAPSIZE=4G\n        SWAPFILE=/${SWAPSIZE}iB.swap\n        sudo /usr/bin/fallocate -l ${SWAPSIZE} ${SWAPFILE};\n        sudo /usr/bin/chmod 600 ${SWAPFILE};\n        sudo /usr/bin/chattr +C ${SWAPFILE};\n        sudo /usr/sbin/mkswap ${SWAPFILE};\n        sudo /usr/sbin/losetup -f ${SWAPFILE};\n        sudo /usr/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1);\n      ) &\n      \n      until etcdctl set /machines/$(hostname)/\"$(date)\" 1; do echo 'etcd not ready...sleeping' && sleep 1; done\n      \n      until fleetctl list-units; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl submit cadvisor.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      until fleetctl submit influxdb.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl start cadvisor; do echo 'fleect not ready...sleeping' && sleep 1; done\n      until fleetctl start influxdb; do echo 'fleect not ready...sleeping' && sleep 1; done\n      \n  - path: /home/core/cadvisor.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=cadvisor\n      \n      After=etcd.service\n      After=fleet.service\n      After=docker.service\n      \n      [Service]\n      TimeoutStartSec=0\n      Restart=always\n      ExecStartPre=-/usr/bin/docker kill %p\n      ExecStartPre=-/usr/bin/docker rm %p\n      ExecStartPre=/usr/bin/docker pull google/cadvisor:latest\n      ExecStart=/usr/bin/bash -c \"until INFLUXDB=$(/usr/bin/etcdctl get /services/influxdb/influxdb.service); do echo 'influxdb not found...retrying' && sleep 1; done && /usr/bin/docker run --rm --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --name=%p google/cadvisor:latest -storage_driver=influxdb -log_dir=/ -storage_driver_host=$INFLUXDB\"\n      ExecStop=/usr/bin/docker stop %p\n      \n      [X-Fleet]\n      Global=true\n      \n  - path: /home/core/influxdb.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=influxdb.service\n      \n      After=bootstrap.service\n      \n      [Service]\n      TimeoutStartSec=0\n      Restart=always\n      EnvironmentFile=/etc/environment\n      ExecStartPre=-/usr/bin/docker kill %p\n      ExecStartPre=-/usr/bin/docker rm %p\n      ExecStartPre=/usr/bin/docker pull tutum/influxdb:latest\n      ExecStart=/usr/bin/bash -c \"/usr/bin/etcdctl set /services/influxdb/influxdb.service ${COREOS_PUBLIC_IPV4}:8086 && /usr/bin/docker run --rm --name %p -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 -e PRE_CREATE_DB=cadvisor tutum/influxdb:latest\"\n      ExecStop=/usr/bin/docker stop %p\n      ExecStopPost=/usr/bin/etcdctl rm /services/influxdb/influxdb.service\n      \n      [X-Fleet]\n      MachineMetadata=role=influxdb\n","response":{"droplet":{"id":2735774,"name":"52cb383e-d355-4e3e-915c-14178ec8ad58","memory":512,"vcpus":1,"disk":20,"region":{"slug":"sfo1","name":"San Francisco 1","sizes":["2gb","4gb","8gb","1gb","16gb","32gb","48gb","512mb","64gb"],"available":true,"features":["virtio","backups","metadata"]},"image":{"id":6198091,"name":"CoreOS 444.0.0 (alpha)","distribution":"CoreOS","slug":"coreos-alpha","public":true,"regions":["sfo1","sgp1","lon1","nyc3","ams3"],"created_at":"2014-09-20T02:07:59Z"},"size":{"slug":"512mb","transfer":1,"price_monthly":5,"price_hourly":0.00744},"locked":true,"status":"new","networks":{},"kernel":null,"created_at":"2014-09-29T14:41:27Z","features":["virtio"],"backup_ids":[],"snapshot_ids":[]},"links":{"actions":[{"id":33429487,"rel":"create","href":"http://api.digitalocean.com/v2/actions/33429487"}]}}},{"id":"3f09e5e3-5ef5-4d48-9b00-70184c242834","provider":"digitalocean","location":"sfo1","size":"512mb","image":"coreos-alpha","keys":["40:85:f0:9b:28:ad:5d:25:b5:51:2e:ad:f3:b3:31:98"],"userData":"#cloud-config\n\ncoreos:\n  etcd:\n    discovery: https://discovery.etcd.io/56220a8c8c77ebd2171f6857c8a015a8\n    addr: $public_ipv4:4001\n    peer-addr: $public_ipv4:7001\n  fleet:\n    public-ip: $public_ipv4\n    metadata: provider=digitalocean,location=sfo1,role=grafana,image=coreos-alpha,size=512mb,id=3f09e5e3-5ef5-4d48-9b00-70184c242834\n\n  ssh_authorized_keys:\n    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDQIwGRmmZKxKiZyWRkGk95wBUuhmyitOfJQBlhLeL7n0qDxueU+oxRH3swrWYbHY8daOAKhlzQmpqAQSoFiLzdK0N5aDRyv5U01wvzRuWbQ3Fk/2iwOUzJx2y/rDVd3NbF26EBTS+7mS2n319r1TNYsuekzMD+VpZBFymcqttoOlgNnuecytpMFj18YuB3muGRgiAWZHx0md1e3/bVuVK16VEJ8MKFPWBsRiZ667gzW5b88XZO4Zvo/wAQgp6vakMaLOinxOt0IhfsVNU/miFd0AMBPq04s+iSApxBvQ/+DbBphQT4bRfgI8w8QgfwO8Hwz4MpojeAk2Dhsvmupyp blakelapierre@gmail.com\n\n  units:\n    - name: etcd.service\n      command: start\n\n    - name: fleet.socket\n      command: start\n      content: |\n        [Socket]\n        ListenStream=/var/run/fleet.socket\n        Service=fleet.service\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: fleet.service\n      command: start\n\n    - name: bootstrap.service\n      command: start\n      content: |\n        [Unit]\n        Description=boostraps us\n\n        Requires=etcd.service\n        Requires=fleet.socket\n        Requires=fleet.service\n        Requires=docker.service\n\n        After=etcd.service\n        After=fleet.socket\n        After=fleet.service\n        After=docker.service\n\n        [Service]\n        ExecStart=/home/core/bootstrap.sh\n\nwrite_files:\n  - path: /home/core/bootstrap.sh\n    owner: core\n    permissions: 0700\n    content: |\n      #!/bin/bash\n      \n      #DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n      \n      cd /home/core\n      \n      \n      (\n        SWAPSIZE=4G\n        SWAPFILE=/${SWAPSIZE}iB.swap\n        sudo /usr/bin/fallocate -l ${SWAPSIZE} ${SWAPFILE};\n        sudo /usr/bin/chmod 600 ${SWAPFILE};\n        sudo /usr/bin/chattr +C ${SWAPFILE};\n        sudo /usr/sbin/mkswap ${SWAPFILE};\n        sudo /usr/sbin/losetup -f ${SWAPFILE};\n        sudo /usr/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1);\n      ) &\n      \n      until etcdctl set /machines/$(hostname)/\"$(date)\" 1; do echo 'etcd not ready...sleeping' && sleep 1; done\n      \n      until fleetctl list-units; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl submit cadvisor.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      until fleetctl submit grafana.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl start cadvisor; do echo 'fleect not ready...sleeping' && sleep 1; done\n      until fleetctl start grafana; do echo 'fleect not ready...sleeping' && sleep 1; done\n      \n  - path: /home/core/cadvisor.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=cadvisor\n      \n      After=etcd.service\n      After=fleet.service\n      After=docker.service\n      \n      [Service]\n      TimeoutStartSec=0\n      Restart=always\n      ExecStartPre=-/usr/bin/docker kill %p\n      ExecStartPre=-/usr/bin/docker rm %p\n      ExecStartPre=/usr/bin/docker pull google/cadvisor:latest\n      ExecStart=/usr/bin/bash -c \"until INFLUXDB=$(/usr/bin/etcdctl get /services/influxdb/influxdb.service); do echo 'influxdb not found...retrying' && sleep 1; done && /usr/bin/docker run --rm --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --name=%p google/cadvisor:latest -storage_driver=influxdb -log_dir=/ -storage_driver_host=$INFLUXDB\"\n      ExecStop=/usr/bin/docker stop %p\n      \n      [X-Fleet]\n      Global=true\n      \n  - path: /home/core/grafana.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=grafana\n      \n      After=bootstrap.service\n      \n      [Service]\n      TimeoutStartSec=0\n      Restart=always\n      ExecStartPre=-/usr/bin/docker kill %p\n      ExecStartPre=-/usr/bin/docker rm %p\n      ExecStartPre=/usr/bin/docker pull tutum/grafana:latest\n      ExecStart=/usr/bin/bash -c \"INFLUXDB=$(/usr/bin/etcdctl get /services/influxdb/influxdb.service) INFLUXDB_HOST=$(echo $INFLUXDB | /usr/bin/awk -F':' '{print $1}') INFLUXDB_PORT=$(echo $INFLUXDB | /usr/bin/awk -F':' '{print $2}') && /usr/bin/docker run --rm --name=%p -p 80:80 -e HTTP_USER=root -e HTTP_PASS=root -e INFLUXDB_HOST=$INFLUXDB_HOST -e INFLUXDB_PORT=$INFLUXDB_PORT -e INFLUXDB_NAME=cadvisor tutum/grafana:latest\"\n      ExecStop=/usr/bin/docker stop %p\n      \n      [X-Fleet]\n      MachineMetadata=role=grafana\n","response":{"droplet":{"id":2735775,"name":"3f09e5e3-5ef5-4d48-9b00-70184c242834","memory":512,"vcpus":1,"disk":20,"region":{"slug":"sfo1","name":"San Francisco 1","sizes":["2gb","4gb","8gb","1gb","16gb","32gb","48gb","512mb","64gb"],"available":true,"features":["virtio","backups","metadata"]},"image":{"id":6198091,"name":"CoreOS 444.0.0 (alpha)","distribution":"CoreOS","slug":"coreos-alpha","public":true,"regions":["sfo1","sgp1","lon1","nyc3","ams3"],"created_at":"2014-09-20T02:07:59Z"},"size":{"slug":"512mb","transfer":1,"price_monthly":5,"price_hourly":0.00744},"locked":true,"status":"new","networks":{},"kernel":null,"created_at":"2014-09-29T14:41:28Z","features":["virtio"],"backup_ids":[],"snapshot_ids":[]},"links":{"actions":[{"id":33429488,"rel":"create","href":"http://api.digitalocean.com/v2/actions/33429488"}]}}},{"id":"1e6bece2-f375-428e-a973-d5abf86fa96e","provider":"digitalocean","location":"sfo1","size":"512mb","image":"coreos-alpha","keys":["40:85:f0:9b:28:ad:5d:25:b5:51:2e:ad:f3:b3:31:98"],"userData":"#cloud-config\n\ncoreos:\n  etcd:\n    discovery: https://discovery.etcd.io/56220a8c8c77ebd2171f6857c8a015a8\n    addr: $public_ipv4:4001\n    peer-addr: $public_ipv4:7001\n  fleet:\n    public-ip: $public_ipv4\n    metadata: provider=digitalocean,location=sfo1,role=broadcaster,image=coreos-alpha,size=512mb,id=1e6bece2-f375-428e-a973-d5abf86fa96e\n\n  ssh_authorized_keys:\n    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDQIwGRmmZKxKiZyWRkGk95wBUuhmyitOfJQBlhLeL7n0qDxueU+oxRH3swrWYbHY8daOAKhlzQmpqAQSoFiLzdK0N5aDRyv5U01wvzRuWbQ3Fk/2iwOUzJx2y/rDVd3NbF26EBTS+7mS2n319r1TNYsuekzMD+VpZBFymcqttoOlgNnuecytpMFj18YuB3muGRgiAWZHx0md1e3/bVuVK16VEJ8MKFPWBsRiZ667gzW5b88XZO4Zvo/wAQgp6vakMaLOinxOt0IhfsVNU/miFd0AMBPq04s+iSApxBvQ/+DbBphQT4bRfgI8w8QgfwO8Hwz4MpojeAk2Dhsvmupyp blakelapierre@gmail.com\n\n  units:\n    - name: etcd.service\n      command: start\n\n    - name: fleet.socket\n      command: start\n      content: |\n        [Socket]\n        ListenStream=/var/run/fleet.socket\n        Service=fleet.service\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: fleet.service\n      command: start\n\n    - name: bootstrap.service\n      command: start\n      content: |\n        [Unit]\n        Description=boostraps us\n\n        Requires=etcd.service\n        Requires=fleet.socket\n        Requires=fleet.service\n        Requires=docker.service\n\n        After=etcd.service\n        After=fleet.socket\n        After=fleet.service\n        After=docker.service\n\n        [Service]\n        ExecStart=/home/core/bootstrap.sh\n\nwrite_files:\n  - path: /home/core/bootstrap.sh\n    owner: core\n    permissions: 0700\n    content: |\n      #!/bin/bash\n      \n      #DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n      \n      cd /home/core\n      \n      \n      (\n        SWAPSIZE=4G\n        SWAPFILE=/${SWAPSIZE}iB.swap\n        sudo /usr/bin/fallocate -l ${SWAPSIZE} ${SWAPFILE};\n        sudo /usr/bin/chmod 600 ${SWAPFILE};\n        sudo /usr/bin/chattr +C ${SWAPFILE};\n        sudo /usr/sbin/mkswap ${SWAPFILE};\n        sudo /usr/sbin/losetup -f ${SWAPFILE};\n        sudo /usr/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1);\n      ) &\n      \n      until etcdctl set /machines/$(hostname)/\"$(date)\" 1; do echo 'etcd not ready...sleeping' && sleep 1; done\n      \n      until fleetctl list-units; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl submit cadvisor.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      until fleetctl submit broadcaster@.service; do echo 'fleet not ready...sleeping' && sleep 1; done\n      \n      until fleetctl start cadvisor; do echo 'fleect not ready...sleeping' && sleep 1; done\n      until fleetctl start broadcaster@1e6bece2-f375-428e-a973-d5abf86fa96e; do echo 'fleect not ready...sleeping' && sleep 1; done\n      \n  - path: /home/core/cadvisor.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=cadvisor\n      \n      After=etcd.service\n      After=fleet.service\n      After=docker.service\n      \n      [Service]\n      TimeoutStartSec=0\n      Restart=always\n      ExecStartPre=-/usr/bin/docker kill %p\n      ExecStartPre=-/usr/bin/docker rm %p\n      ExecStartPre=/usr/bin/docker pull google/cadvisor:latest\n      ExecStart=/usr/bin/bash -c \"until INFLUXDB=$(/usr/bin/etcdctl get /services/influxdb/influxdb.service); do echo 'influxdb not found...retrying' && sleep 1; done && /usr/bin/docker run --rm --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --name=%p google/cadvisor:latest -storage_driver=influxdb -log_dir=/ -storage_driver_host=$INFLUXDB\"\n      ExecStop=/usr/bin/docker stop %p\n      \n      [X-Fleet]\n      Global=true\n      \n  - path: /home/core/broadcaster@.service\n    owner: core\n    permissions: 0600\n    content: |\n      [Unit]\n      Description=broadcaster@%i\n      \n      After=etcd.service\n      After=fleet.service\n      After=docker.service\n      After=collectd.service\n      \n      [Service]\n      TimeoutStartSec=0\n      ExecStartPre=-/usr/bin/docker kill %p.%i\n      ExecStartPre=-/usr/bin/docker rm %p.%i\n      ExecStartPre=-/usr/bin/docker pull instantchat/broadcaster\n      ExecStart=/usr/bin/docker run --name=%p.%i --rm --privileged instantchat/broadcaster\n      ExecStop=/usr/bin/docker stop %p.%i\n      \n      [X-Fleet]\n      MachineMetadata=role=broadcaster\n","response":{"droplet":{"id":2735776,"name":"1e6bece2-f375-428e-a973-d5abf86fa96e","memory":512,"vcpus":1,"disk":20,"region":{"slug":"sfo1","name":"San Francisco 1","sizes":["2gb","4gb","8gb","1gb","16gb","32gb","48gb","512mb","64gb"],"available":true,"features":["virtio","backups","metadata"]},"image":{"id":6198091,"name":"CoreOS 444.0.0 (alpha)","distribution":"CoreOS","slug":"coreos-alpha","public":true,"regions":["sfo1","sgp1","lon1","nyc3","ams3"],"created_at":"2014-09-20T02:07:59Z"},"size":{"slug":"512mb","transfer":1,"price_monthly":5,"price_hourly":0.00744},"locked":true,"status":"new","networks":{},"kernel":null,"created_at":"2014-09-29T14:41:28Z","features":["virtio"],"backup_ids":[],"snapshot_ids":[]},"links":{"actions":[{"id":33429489,"rel":"create","href":"http://api.digitalocean.com/v2/actions/33429489"}]}}}]